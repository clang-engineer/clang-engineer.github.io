<!-- The trending tags list for wikis -->

{% assign MAX = 10 %}

{% assign tag_counts = '' | split: '' %}

{% for wiki in site.wikis %}
  {% for tag in wiki.tags %}
    {% assign tag_entry = tag | append: '::0' %}
    {% assign existing_tag = tag_counts | where_exp: "t", "t contains tag" | first %}

    {% if existing_tag %}
      {% assign count = existing_tag | split: '::' | last | plus: 1 %}
      {% assign updated_entry = tag | append: '::' | append: count %}
      {% assign tag_counts = tag_counts | where_exp: "t", "t != existing_tag" %}
      {% assign tag_counts = tag_counts | push: updated_entry %}
    {% else %}
      {% assign tag_counts = tag_counts | push: tag_entry %}
    {% endif %}
  {% endfor %}
{% endfor %}

{% assign tag_counts = tag_counts | sort_natural %}

{% assign sorted_tags = tag_counts | sort: '::' | reverse %}

{% assign trending_tags = '' | split: '' %}

{% for tag_entry in sorted_tags limit: MAX %}
  {% assign tag_name = tag_entry | split: '::' | first %}
  {% assign trending_tags = trending_tags | push: tag_name %}
{% endfor %}

{% if trending_tags.size > 0 %}
  <section>
    <h2 class="panel-heading">{{- site.data.locales[include.lang].panel.trending_tags -}}</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      {% for tag_name in trending_tags %}
        {% assign url = tag_name | slugify | url_encode | prepend: '/tags/' | append: '/' %}
        <a class="post-tag btn btn-outline-primary" href="{{ url | relative_url }}">{{ tag_name }}</a>
      {% endfor %}
    </div>
  </section>
{% endif %}
