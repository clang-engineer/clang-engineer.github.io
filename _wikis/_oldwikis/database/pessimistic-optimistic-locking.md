---
layout  : wiki
title   : Pessimistic vs Optimistic Locking
summary : 
date    : 2023-12-10 18:29:37 +0900
updated : 2023-12-10 18:29:59 +0900
tags    : 
toc     : true
public  : true
parent  : [[database/index]]
latex   : false
---
* TOC
{:toc}

# Pessimistic Locking (비관적 락)
- 자원 요청에 따른 동시성문제가 발생할것이라고 예상하고 락을 걸어버리는 방법론
- 하나의 트랜잭션이 자원에 접근시 락을 걸고, 다른 트랜잭션이 접근하지 못하게 하는 방식
- 데이터베이스에서 Shared Lock(공유, 읽기 잠금) 이나 Exclusive Lock(배타, 쓰기 잠금) 을 건다.
- Shared Lock 의 경우, 다른 트랜잭션에서 읽기만 가능. 또한 Exclusive lock 적용이 불가능(읽는동안 변경하는것을 막기 위해)
- Exclusive lock 의 경우. 다른 트랜잭션에서 읽기, 쓰기가 둘다 불가능. 또한 Shared, Exclusive Lock 적용이 추가적으로 불가능 (쓰는동안 읽거나, 다른 쓰기가 오는것을 막기위해)

## 장점
- 충돌 발생을 미연에 방지하고 데이터의 일관성을 유지할 수 있다.
- 데이터 무결성 보장 수준이 높다.

## 단점
- 동시성이 떨어진다.
- 데드락이 발생할 수 있다. (서로 다른 트랜잭션이 서로의 락을 기다리는 상황)
- 락으로 인한 오버헤드가 발생한다.

# Optimistic Locking (낙관적 락)
- 자원 요청에 따른 동시성문제가 발생하지 않을것이라고 예상하고 락을 걸지 않는 방법론
- 하나의 트랜잭션이 자원에 접근시 락을 걸지 않고, 다른 트랜잭션이 접근가능하게 하는 방식
- 데이터베이스에서 Versioning 을 통해 처리한다.
- 데이터를 읽어올 때 버전을 함께 읽어오고, 데이터를 갱신할 때 버전을 함께 갱신한다.(별도로 버전 정보를 관리하거나, hashcode, timestamp등을 사용해서 충돌을 확인할 수 있다.)
- 데이터를 갱신할 때 버전을 함께 갱신한다.
- DB 에서 동시성을 처리하는 것이 아니라, 애플리케이션에서 처리한다.

## 장점
- 동시성이 높다.
- 데드락이 발생하지 않는다.
- 락으로 인한 오버헤드가 발생하지 않는다.

## 단점
- 충돌 발생시 별도 롤백 처리를 해야한다.
- 데이터 무결성 보장 수준이 낮다.

# 출처 & 참
- [https://leejincha.tistory.com/361](https://leejincha.tistory.com/361)